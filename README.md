# n-body-choreographies-C

## Дифференциальное уравнение системы

Уравнение движения каждого тела (индекс \(i\)) задаётся законом всемирного тяготения Ньютона:
  
$$
\frac{d^2 \mathbf{r}_i}{dt^2} = \sum_{\substack{j=1 \\ j \neq i}}^{N} \frac{GM}{\left\lVert \mathbf{r}_j - \mathbf{r}_i \right\rVert^3} \, (\mathbf{r}_j - \mathbf{r}_i)
$$

где:
- \(\mathbf{r}_i = (x_i, y_i)\) — координаты тела \(i\);
- \(G\) — гравитационная постоянная;
- \(M\) — масса каждого тела.

## Система в каноническом виде

Введём скорость

$$
\mathbf{v}_i = \frac{d\mathbf{r}_i}{dt}.
$$

Тогда система уравнений в каноническом виде принимает следующий вид:

$$
\begin{cases}
\frac{d\mathbf{r}_i}{dt} = \mathbf{v}_i, \\
\\
\frac{d\mathbf{v}_i}{dt} = \displaystyle\sum_{\substack{j=1 \\ j \neq i}}^{N} \frac{GM}{\left\lVert \mathbf{r}_j - \mathbf{r}_i \right\rVert^3} \, (\mathbf{r}_j - \mathbf{r}_i)
\end{cases}
$$

для \(i = 1, 2, \dots, N\).

## Численные методы интегрирования

### Метод Рунге–Кутты 4-го порядка (RK4)

Для интегрирования системы ОДУ используется классический метод RK4. Пусть \(y(t)\) — вектор состояния системы (координаты и скорости всех тел), а \(f(t, y)\) вычисляет его производную. Тогда схема метода выглядит так:

$$
\begin{aligned}
k_1 &= f(t, y), \\
k_2 &= f\left(t + \frac{h}{2},\, y + \frac{h}{2} k_1\right), \\
k_3 &= f\left(t + \frac{h}{2},\, y + \frac{h}{2} k_2\right), \\
k_4 &= f(t + h,\, y + h k_3), \\
\\
y(t+h) &= y(t) + \frac{h}{6} \left( k_1 + 2k_2 + 2k_3 + k_4 \right),
\end{aligned}
$$

где \(h\) — шаг интегрирования.

### Метод Дорманда–Принса 8-го порядка (DOPRI8)

Для повышения точности также реализуется метод Дорманда–Принса 8-го порядка (DOPRI8). Он вычисляет промежуточные коэффициенты \(k_i\) по формуле:

$$
k_i = f\left(t + c_i h,\, y + h \sum_{j=1}^{i-1} a_{ij} k_j\right), \quad i = 1, 2, \dots, 13,
$$

а обновление состояния происходит по формуле:

$$
y(t+h) = y(t) + h \sum_{i=1}^{13} b_i k_i.
$$

Коэффициенты \(c_i\), \(a_{ij}\) и \(b_i\) заданы в виде таблиц непосредственно в исходном коде.

## Вычисление энергии системы

Для контроля качества численного интегрирования рассчитывается полная энергия системы, которая состоит из кинетической и потенциальной энергии.

### Кинетическая энергия

$$
E_{\text{kin}} = \sum_{i=1}^{N} \frac{1}{2} M \|\mathbf{v}_i\|^2
= \sum_{i=1}^{N} \frac{1}{2} M \left( v_{x,i}^2 + v_{y,i}^2 \right)
$$

### Потенциальная энергия

$$
E_{\text{pot}} = - \sum_{i=1}^{N} \sum_{j=i+1}^{N} \frac{GM^2}{\left\lVert \mathbf{r}_j - \mathbf{r}_i \right\rVert}
$$

### Полная энергия

$$
E = E_{\text{kin}} + E_{\text{pot}}
$$

## Дополнительные сведения

Данный проект моделирует хореографии N тел с использованием выбранных начальных условий (например, решение «фигура-8» для трёх тел), что позволяет обеспечить периодическое движение без столкновений. Реализация включает визуализацию траекторий с помощью SDL, а также сравнительный анализ точности численных методов (RK4 и DOPRI8) на основе сохранения инвариантов системы.

---
