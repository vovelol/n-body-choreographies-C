# n-body-choreographies-C

Этот проект реализует численное моделирование хореографий N тел в гравитационной системе. Для интегрирования системы используются два метода: классический метод Рунге–Кутты 4-го порядка (RK4) и метод Дорманда–Принса 8-го порядка (DOPRI8). Реализация выполнена на языке C с визуализацией 2D-анимации (используется SDL).

## Физическая модель

Движение каждого тела описывается законами Ньютона для гравитационного взаимодействия. Для тела \(i\) с массой \(M\) имеем систему уравнений:
\[
\begin{aligned}
\frac{d\mathbf{r}_i}{dt} &= \mathbf{v}_i, \\
\frac{d\mathbf{v}_i}{dt} &= \sum_{j \neq i} \frac{G\,M}{\|\mathbf{r}_j - \mathbf{r}_i\|^3} \, (\mathbf{r}_j - \mathbf{r}_i),
\end{aligned}
\]
где:
- \(\mathbf{r}_i = (x_i, y_i)\) — координаты тела \(i\);
- \(\mathbf{v}_i = (v_{x,i}, v_{y,i})\) — скорость тела \(i\);
- \(G\) — гравитационная постоянная.

Эти уравнения второго порядка приведены к системе ОДУ первого порядка за счёт введения переменной скорости.

## Численные методы интегрирования

### 1. Классический метод Рунге–Кутты 4-го порядка (RK4)

Для интегрирования ОДУ метод RK4 использует следующие формулы. Пусть \(y(t)\) — вектор состояния системы (координаты и скорости всех тел), а \(f(t, y)\) вычисляет его производную:
\[
\begin{aligned}
k_1 &= f(t, y), \\
k_2 &= f\!\left(t + \frac{h}{2},\, y + \frac{h}{2}\, k_1\right), \\
k_3 &= f\!\left(t + \frac{h}{2},\, y + \frac{h}{2}\, k_2\right), \\
k_4 &= f(t + h,\, y + h\, k_3), \\
y(t+h) &= y(t) + \frac{h}{6}\,\Bigl(k_1 + 2\,k_2 + 2\,k_3 + k_4\Bigr).
\end{aligned}
\]
Здесь \(h\) — шаг интегрирования.

### 2. Метод Дорманда–Принса 8-го порядка (DOPRI8)

Метод DOPRI8 является явным методом Рунге–Кутты с 13 этапами и достигает 8-го порядка точности. Он вычисляет промежуточные коэффициенты \(k_i\) следующим образом:
\[
k_i = f\!\left(t + c_i\,h,\, y + h \sum_{j=1}^{i-1} a_{ij}\, k_j\right), \quad i = 1, 2, \dots, 13,
\]
где коэффициенты \(c_i\) и \(a_{ij}\) задаются таблицами.

После вычисления всех \(k_i\) состояние обновляется по формуле:
\[
y(t+h) = y(t) + h \sum_{i=1}^{13} b_i\, k_i,
\]
где \(b_i\) — также фиксированные коэффициенты.

В проекте соответствующие коэффициенты заданы в виде массивов в коде.

## Вычисление энергии системы

Для контроля качества численного интегрирования и сохранения инвариантов системы рассчитывается полная энергия, которая состоит из кинетической и потенциальной энергии.

### Кинетическая энергия

Для \(N\) тел кинетическая энергия вычисляется по формуле:
\[
E_{\text{kin}} = \sum_{i=1}^{N} \frac{1}{2}\, M\, \|\mathbf{v}_i\|^2 = \sum_{i=1}^{N} \frac{1}{2}\, M\, (v_{x,i}^2 + v_{y,i}^2).
\]

### Потенциальная энергия

Гравитационная потенциальная энергия системы:
\[
E_{\text{pot}} = - \sum_{i=1}^{N} \sum_{j=i+1}^{N} \frac{G\,M^2}{\|\mathbf{r}_j - \mathbf{r}_i\|}.
\]

### Полная энергия

Суммарная энергия системы определяется как:
\[
E = E_{\text{kin}} + E_{\text{pot}}.
\]
Контроль сохранения энергии позволяет оценить точность работы численных методов.

## Дополнительные детали

- **Гравитационное ускорение:**  
  Для тела \(i\) ускорение, вызванное взаимодействием с телом \(j\), вычисляется по формуле:
  \[
  \mathbf{a}_{ij} = \frac{G\,M}{\|\mathbf{r}_j - \mathbf{r}_i\|^3}\, (\mathbf{r}_j - \mathbf{r}_i).
  \]
  Итоговое ускорение для тела \(i\) получается суммированием вкладов всех остальных тел.

- **Хореографии:**  
  Выбранные начальные условия (например, решение "фигура-8" для трёх тел) гарантируют, что тела движутся периодически, избегая столкновений. Это позволяет исследовать устойчивые хореографические траектории в системе N тел.
